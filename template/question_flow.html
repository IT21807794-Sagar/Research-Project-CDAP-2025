{% extends "base.html" %}

{% block content %}
<div class="question-screen">
    <div class="question-content">
        

        <div class="question-card">
            <div class="question-text">
                <h3>{{ question_data.question }}</h3>
            </div>

            <div class="options-container">
                {% for option, text in question_data.options.items() %}
                <div class="option" data-option="{{ option }}">
                    <span class="option-letter">{{ option }})</span>
                    <span class="option-text">{{ text }}</span>
                </div>
                {% endfor %}
            </div>

            

            <button id="submitAnswer" class="submit-button" disabled>Submit Answer</button>
        </div>


    </div>
</div>

 

<script>
let selectedOption = null;
let stressDetected = false;

document.querySelectorAll('.option').forEach(option => {
    option.addEventListener('click', function() {
        document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        selectedOption = this.dataset.option;
        document.getElementById('submitAnswer').disabled = false;
    });
});

document.querySelectorAll('.stress-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.stress-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        stressDetected = this.dataset.stress === 'true';
    });
});

document.getElementById('submitAnswer').addEventListener('click', function() {
    if (!selectedOption) return;

    this.disabled = true;
    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

    const formData = new FormData();
    formData.append('answer', selectedOption);
    formData.append('stress_detected', stressDetected);

    fetch('/submit_answer', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        showFeedback(data);
    })
    .catch(error => {
        console.error('Error:', error);
        this.innerHTML = 'Submit Answer';
        this.disabled = false;
    });
});

function showFeedback(evaluation) {
    const feedbackHTML = `
        <div class="feedback-overlay">
            <div class="feedback-content">
                <h3>${evaluation.is_correct ? '<i class="fas fa-check-circle success"></i> Correct!' : '<i class="fas fa-times-circle error"></i> Incorrect'}</h3>
                <p>${evaluation.feedback}</p>
                ${evaluation.explanation ? `<div class="explanation"><strong>Explanation:</strong> ${evaluation.explanation}</div>` : ''}
                ${evaluation.common_mistakes ? `<div class="common-mistakes"><strong>Common Mistakes:</strong> ${evaluation.common_mistakes}</div>` : ''}
                ${!evaluation.is_correct ? `<div class="correct-answer"><strong>Correct Answer:</strong> ${evaluation.correct_answer}</div>` : ''}
                <div class="response-time">Response time: ${evaluation.response_time.toFixed(1)} seconds</div>
                <button id="nextQuestion" class="next-button">Continue <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
    `;

    document.body.insertAdjacentHTML('beforeend', feedbackHTML);

    document.getElementById('nextQuestion').addEventListener('click', function() {
        window.location.reload();
    });
}
</script>
{% endblock %}